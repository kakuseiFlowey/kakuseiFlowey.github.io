<!DOCTYPE html>
<html>
	<head>
		<title>コンパスガチャシミュレータ</title>
	</head>
	<body>
		<script>
			/*======================
			↓↓ここの数値をいじる
			======================*/
			var user_rank = 6;//ガチャで解放されてるカードランク，0 = F, 1 = E, 2 = D, 3 = C, 4 = B, 5 = A, 6 = S1～
			var nanren = 60;//何連か．60なら60連
			var bairitu = [];
			bairitu[0] = [2.0, 1.5];//UR, SRの出現倍率(デフォ1倍，よくあるのは2.0,1.5倍)
			bairitu[1] = [1, 1, 1];//常設火, 水, 木属性の出現倍率（0,1,2みたいに整数で頼む）
			bairitu[2] = [1,0,0,0,0,0,0,0,0,0,0,0,0];//コラボの出現倍率，左からGG，ミク，SF，リゼロ，殺天，ダンロン，このすば，進撃，猫宮，シュタゲ，Fate，歌舞伎，ダンまち
			//↓ピックアップ関連のパラメータ．完全に理解したらいじるべし
			var is_pickup = 0;//個別ピックアップ(なし，あり) = (0,1)
			var pickup_rate = 20;//大会優勝チームのピックアップなど，個別にかかる倍率
			var pickup_name = "妻ピックアップ";//ピックアップ名
			var pickup_num = [//ピックアップ対象カード指定配列[レア度0~2=UR~R，解放ランク，カード番号]
				//2020/8/20 ルミナス優勝ピックアップ5倍ラインナップ↓
				//[0,0,3],//ソーン
				//[0,2,3],//お母さん
				//[0,3,2],//ドア
				//[0,4,5],//バーゲン
				//[0,4,8],//ミローディア
				//[0,5,2],//アバカン
				//[0,6,4],//マジスク
				//[0,6,6],//ユニドール
				//[0,6,12],//ディーバ
				//[0,6,14],//イデア
				//[0,6,16],//ワキンヤン
				//[1,4,6]//イェーガー
				//2020/9/17 妻ピックアップ↓
				[0,6,19]//妻
			];

			/*======================
			↑↑ここの数値をいじる
			======================*/
			/*

			================================================================
			===これを見てる人向け　自分でパラメータ設定して実行する方法（PC版）===
			================================================================
			1. このコードを全て選択してコピーする（「Ctrl + A」で選択して「Ctrl + C」でコピー）
			2. メモ帳に貼り付け（「Ctrl + V」で貼り付け），パラメータを好きに設定する（下の例などを参考に）
			3. 適当な名前を付けて適当なところに保存（例えば「gatya.txt」と名付けてデスクトップに保存）
			4. ファイルの名前を変更して拡張子を「.html」にする（「gatya.txt」を「gatya.html」に．なんか通知出ても「はい」でおｋ）
			5. ファイルを右クリックし，「プログラムから開く」からブラウザ（ChromeとかFirefoxとか）を選択
			6. おめでとう！好きなパラメータでガチャシミュレーションできたね！更新ボタンで何度でも回せるぞ！
			================================================================

			例1:---ダンロンコラボカード15倍，UR2倍，SR1.5倍の60連パラメータ設定例---
			var user_rank = 6;
			var nanren = 60;
			var bairitu = [];
			bairitu[0] = [2.0, 1.5];
			bairitu[1] = [1, 1, 1];
			bairitu[2] = [0,0,0,0,0,15,0,0,0,0,0,0,0];
			例2:---UR15%SR以上確定11連のパラメータ設定例---
			var user_rank = 6;
			var nanren = 11;
			var bairitu = [];
			bairitu[0] = [15.0, 100];//SR以上確定にするにはSR倍率をクソ高くすれば良い．UR確定ならURを100にする
			bairitu[1] = [1, 1, 1];
			bairitu[2] = [0,0,0,0,0,0,0,0,0,0,0,0,0];
			*/
			function getRandomInt(min, max) {
			  min = Math.ceil(min);
			  max = Math.floor(max);
			  return Math.floor(Math.random() * (max - min)) + min; //The maximum is exclusive and the minimum is inclusive
			}

			var korabo = bairitu[2].length;//ガチャありコラボの数
			var korabo_name = ["ギルティギア", "ボカロ", "ストV", "リゼロ", "殺戮の天使", "ダンガンロンパ", "このすば", "進撃の巨人", "猫宮ひなた", "Steins;Gate", "Fate", "超歌舞伎x千本桜", "ダンまち"];
			var only_korabo = [1,0,0,0,0,0,0,0,0,0,0,0,0];//コラボのみ出現するなら1,常設も出るなら0
			var rank = ["F", "E", "D", "C", "B", "A", "S1~"];
			var rarity = ["UR", "SR", "R"];
			var rarity_rate = [0.01, 0.09, 0.9];
			rarity_rate[0] = Math.min(rarity_rate[0] * bairitu[0][0], 1);
			rarity_rate[1] = Math.min(rarity_rate[1] * bairitu[0][1], 1 - rarity_rate[0]);
			rarity_rate[2] = 1.0 - rarity_rate[0] - rarity_rate[1];//使わないけど一応Rの出現率

			var card_name = [3];//カード名のオリジナル配列
			var card_type = [3];//カード属性，0,1,2 = 火,水,木
			card_name[0] = [
				["ギアメーカー", "【我羨惚（がせんこつ）】紗夢（じゃむ）", "【アイアンメイデン】ミリア", "【アイウォントアウト】ジャック・オー", "【アニモエスティンギ】ラムレザル", "【マグナムウェディング】エルフェルト", "【ライディーン】シン", "【ライジング・フォース】カイ", "【口寄せ・大型神陣】アンサー", "【画竜点睛】梅喧（ばいけん）"],
				["【祝福する歌姫】初音 ミク", "【号令する歌姫】初音 ミク", "【空駆ける歌姫】初音 ミク", "【夢超える共演】初音ミク＆鏡音リンレン", "【熱狂する双演】鏡音リン＆鏡音レン"],
				["【最終最凶】ベガ", "【拳を極めし者】豪鬼", "【魂屠る闇】ネカリ", "【ラッシュ＆ブレイズ】ケン"],
				["【リゼロ】間断なき結束", "【リゼロ】ひとときの団欒", "【リゼロ】絶望という病", "【リゼロ】ゼロから始まる異世界生活"],
				["【イカれた約束】ザック＆レイ", "【ルナティック・アイズ】レイチェル", "【愉悦の一閃】アイザック"],
				["【超高校級のゲーマー】七海 千秋", "【超高校級の幸運】狛枝 凪斗", "【超高校級の希望】苗木 誠"],
				["【風呂上りの休息】アクア＆めぐみん", "【駄女神's】アクア＆めぐみん＆ダクネス", "【慈愛の貧乏リッチー】ウィズ", "【爆裂アークウィザード】めぐみん"],
				["【進撃の巨人】娘々ストレッチ", "【進撃の巨人】超大型巨人襲来", "【進撃の巨人】小さな刃"],
				["【火遊びフラッシュバン】猫宮ひなた", "【ワンショットワンキル】猫宮ひなた", "【最高にハイ!!!エナドリ】猫宮ひなた"],
				["【STEINS;GATE】時間跳躍の協力者", "【STEINS;GATE】未来を司る女神作戦", "【STEINS;GATE】黄昏の憩い"],
				["【Fate/stay night[HF]】激辛麻婆豆腐", "【Fate/stay night[HF]】狂戦士の咆哮", "【Fate/stay night[HF]】lost butterfly", "【Fate/stay night[HF]】舞い散る桜"],
				["【超歌舞伎】今昔饗宴千本桜", "【超歌舞伎】転生なしたる白狐", "【千本桜】初音未來"],
				["【ダンまち】ソード・オラトリア", "【ダンまち】眷属の物語（ファミリア・ミィス）", "【ダンまち】至福の一時"],//ダンまち
				["究極系ノーガード戦法", "ぶじゅつかの超速加速", "楽団長 ドルケストル", "-蒼王宮- 恩寵天使 ソーン=ユーリエフ"],
				["対消滅ロングレンジライフルHum-Buster", "名門サッカー部 イナズマシュート", "魂を司る聖天使 ガブリエル", "妖炎参謀 月夜叉"],
				["機航師団 フルーク・ツォイク", "荒れ狂う天空王 ぶれいずどらごん", "祭りの真打ち！打ち上げ花火", "おかあさん だーいすき"],
				["連合宇宙軍 強襲制圧型 装甲多脚戦車", "祭りの目玉！ドラゴン花火", "どこにでもいけるドア"],
				["妖軍一統 ゲネラール", "宇宙連合軍 シールドブレイカー", "恒星間転送装置 Tele-Pass", "反導砲 カノーネ・ファイエル", "おとうさん あそんであそんでー", "ミナ＆ルナ＆レナのバーゲンセール戦争", "ハイカラ盟友忍者 -壬生咲みみみ-", "＊絢爛ノ美＊ ボラ＆アルヒコ＆アペイロン", "-蒼王宮- 聖歌連隊 ミローディア", "【デルミン】デビルミント始龍", "合体攻撃！ドリーム☆エンジェルズアロー"],
				["学園の王者 生徒会執行部", "オールレンジアタック", "迅雷の科学者 アバカン", "宇宙連合軍 サテライトキャノン", "全員集合！魔法少女リリカ☆ルルカ", "狂愛の次女 ヴァルヴァラ", "紅薔薇の暗殺術 クルエルダ－", "チーちゃんのウワキオシオキ狙撃", "創霊の加護 タイオワ", "＊真実ノ美＊ ジョバンニ", "【デルミン】デビルミント鬼龍パパミン", "絶夢の魔女 リべレーション★ルルカ"],
				["とある家庭用メカの反乱", "運命の女神 エボリューション☆リリカ", "革命の旗", "深淵より湧き上がるシャドウ", "ドリーム☆マジカルスクエア", "全天首都防壁 Hum-Sphere LLIK", "銀河防衛ロボ Unidoll-2525", "祭りの粋！オトコの手筒花火", "モノリス Hum-Unknown", "神技官 アンジュ・ソレイユ", "独災者 アングリフ・ギフト", "忘愛の長女 アレクサンドラ", "楽団姫 ディーバ", "紅薔薇の副団長 アミスター", "-蒼王宮-氷冠女王イデア=N=ユランブルク", "ガルガルのピカピカデコ戦車", "雷霊の加護 ワキンヤン", "ライバル狂刃忍者 -幽々院ゆらら-", "-蒼王宮- 終焉禁獣 グラナート", "背に負いし亡き妻の加護", "#夜光犯罪特区 #きてるちゃんライヴ", "#夜光犯罪特区 #終夜の俺様賛美会", "エナジー缶 100000ml"]
				];
			card_type[0] = [
				[2,0,1,0,2,0,1,1,2,0],//GG．まあコラボは属性情報いらんけど一応
				[0,0,2,1,0],//ミクリンレン
				[1,1,2,0],//SF
				[0,1,2,0],//リゼロ
				[1,0,2],//殺戮の天使
				[1,0,2],//ダンロン
				[1,2,1,0],//このすば
				[1,0,2],//進撃
				[0,0,1],//猫宮
				[2,1,0],//シュタゲ
				[0,2,1,2],//Fate
				[1,0,2],//歌舞伎
				[1,0,2],//ダンまち↓↓新コラボはここに追加
				[0,2,0,1],//Fランクカード↑↑新コラボはここに追加
				[1,2,1,0],
				[0,2,2,2],
				[1,0,2],
				[0,2,1,1,1,2,0,2,0,1,2],
				[1,1,2,1,0,1,2,2,0,1,2,0],
				[0,1,0,0,1,2,1,0,1,0,2,0,1,0,1,0,2,2,1,0,1,2,1]
				];
			card_name[1] = [
				["【刺激的絶命拳】ファウスト", "蔵土縁紗夢（くらどべり じゃむ）", "メイ", "ジャック・オー", "ラムレザル＝ヴァレンタイン", "エルフェルト＝ヴァレンタイン", "シン＝キスク", "カイ＝キスク", "ディズィー", "ソル＝バッドガイ"],
				["【チャームスピーカー】初音 ミク", "【ピースメーカー】初音 ミク", "【スカイウォーカー】初音 ミク", "【パワフルプレイヤー】鏡音 レン", "【ハッピーシンガー】鏡音 リン"],
				["ダルシム", "バルログ", "M.バイソン", "F.A.N.G"],
				["フェリス", "ベアトリス", "ラム", "スバル"],
				["ピザック", "レイチェル・ガードナー", "アイザック・フォスター"],
				["江ノ島 盾子", "田中 眼蛇夢", "日向 創"],
				["ゆんゆん", "ウィズ", "ダクネス", "カズマ"],
				["【進撃の巨人】アルミン", "【進撃の巨人】ミカサ", "【進撃の巨人】エレン"],
				["【パルクール2丁拳銃】猫宮ひなた", "【ぶっぱ短機関銃】猫宮ひなた", "【ニヒヒ対人地雷】猫宮ひなた"],
				["阿万音 鈴羽", "橋田 至", "フェイリス・ニャンニャン"],
				["遠坂凛", "間桐桜 -マキリの杯-", "ライダー", "衛宮士郎"],
				["【超歌舞伎】母と娘の絆", "【超歌舞伎】青龍の精", "【千本桜】鏡音鈴＆鏡音錬"],
				["リュー・リオン", "ベル・クラネル", "リリルカ・アーデ"],//ダンまち
				["操宴軍馬 べディーネン・パンツァー", "一撃必殺 ブラストアッパー", "楽団員 サンバール"],
				["焼却ロボ Fladoll-4649", "ひめたる力の覚醒", "聖女の守り手 黒猫リリィ", "楽団員 アルプ", "-蒼王宮- 白翼騎士 ジェニト", "樹霊の加護 イシュティニケ"],
				["ゲームバズーカ", "聖槍ろんぎぬす", "連合宇宙軍 フルアーマー機動兵", "おにいちゃん ぎゅーってして", "ドスブラック★シスコンブラザー"],
				["切り裂き魔 ジャック", "祭り行列！山車燈籠", "あこがれのアイドルからの声援", "情愛の四女 クララ", "紅薔薇の不壊盾 イノセンテ", "デジタル堅牢忍具 -不可視金蔵-", "＊振付ノ美＊ オルケーシス", "-蒼王宮- 黒滅導師 アカンティラド", "【デルミン】エンジェリック.A.破虎"],
				["放火魔 スコーピオン", "電撃ロボ Eledoll-115", "聖女の前衛 ジル・ド・レ", "聖女の後衛 銃士レオン", "地獄の番犬 ケルベロス", "連合宇宙軍 広域電磁波ジャマー", "帝皇機神 ケーニヒ・イェーガー", "ゼルっちの横流しフルオートライフル", "オンエア部下忍者 -アニマルチューバーズ-", "＊伝説ノ美＊ プロティバラリナ", "【デルミン】デビルミント島", "#夜光犯罪特区 #やめるちゃんアゲ", "エナジー缶 4000ml"],
				["看守長 キャバルリー", "全翼飛将 グライフ", "魔法少女☆ルルカ", "化学部の放課後ジッケンタイム", "祭りの華！だんじりガール", "拷問館 パウ・ライヒェ", "奏愛の三女 エレオノーラ", "紅薔薇の生命線 パレンティア", "-蒼王宮- 翠光騎士 リョーフキー", "-蒼王宮- 監獄騎士 ヴィーセリツァ", "#夜光犯罪特区 #メビウス目撃情報", "魔法少女 レレカ☆ロロカ"],
				["魔法少女☆ララカ", "祭り開始！どでかい和太鼓", "呪詛包帯"]
				];
			card_type[1] = [
				[2,0,2,0,2,2,1,1,1,0],//GG
				[2,1,1,0,2],//ミクリンレン
				[0,0,1,2],//SF
				[1,0,1,2],//リゼロ
				[1,0,1],//殺戮の天使
				[2,1,0],//ダンロン
				[0,1,0,2],//このすば
				[2,1,0],//進撃
				[1,2,2],//猫宮
				[1,2,0],//シュタゲ
				[0,1,2,0],//Fate
				[0,1,2],//歌舞伎
				[2,0,1],//ダンまち
				[2,0,1],//Fランクカード
				[0,2,1,0,1,0],
				[2,2,1,2,0],
				[2,0,1,,0,0,0,1,1,2],
				[0,2,0,2,0,1,1,0,2,0,1,1,1],
				[1,2,0,0,1,2,2,0,2,2,0,1],
				[1,0,1]
				];
			card_name[2] = [
				["よく話し相手になってくれました", "よく喧嘩相手になってくれました", "ファイヤーホイール Mk.Ⅱ", "ジャンクヤード・ドッグ"],
				[],
				[],
				[],
				[],
				[],
				[],
				[],
				[],
				[],
				[],
				[],
				[],
				["ドリーム☆ミーティア", "保健室の救急セット", "連合宇宙軍 ステルス迷彩", "雨霊の加護 ウィネバ"],
				["初級魔法 ふれいむ", "初級魔法 ぶりざーど", "銀行強盗 デリンジャー"],
				["はらぺこゴースト", "聖女の親友 修道女マリー", "たんじょうび ぷれぜんと", "紅薔薇の聖王剣 セルピエンテ", "アイちゃんのオススメ防弾パーカー", "＊支配ノ美＊ エレンホス", "#夜光犯罪特区 #天馬エイワズ", "エナジー缶 1000ml"],
				["連合宇宙軍 ジャスティスハンマー", "きょうせんしの大剣", "爆弾魔 バルカン", "爆術死鬼 ツクモ", "祭りの終わり！満天提灯", "崩愛の爆弾 ジ・エラー", "レーザー特注忍具 -双天小鳥丸-"],
				["はらぺこ吸血バット", "死献薬 シュタルク・トート"],
				["剣道部エースの五月雨突き", "千血妖刀 牛鬼村正", "はらぺこメイジ", "祭りの思い出！おじいちゃんの祝砲", "【デルミン】オニギリクママン"],
				["反政府勢力クラッキング Case-171", "かぞく みんなで おしゃしん"]
				];
			card_type[2] = [
				[1,0,2,0],//GG
				[],
				[],
				[],
				[],
				[],
				[],
				[],
				[],
				[],
				[],
				[],
				[],
				[0,2,1,1],
				[0,1,2],
				[1,1,0,2,0,2,0,1],
				[0,1,2,0,0,1,1],
				[0,1],
				[1,2,2,0,0],
				[2,2]
				];

				var card_pick = [[],[],[]];//カードピックアップ率，デフォルトは1
				for(i = 0;i < 3;i++){
					for(j = 0;j <= korabo + 6;j++){
						card_pick[i].push([]);
						var len = card_name[i][j].length;
						for(k = 0;k < len;k++){
							card_pick[i][j].push(1);
						}
					}
				}//デフォルトのcard_pick配列を生成
				if(is_pickup == 1){//ピックアップガチャなら倍率を反映
					var len = pickup_num.length;
					for(i = 0;i < len;i++){
						card_pick[pickup_num[i][0]][korabo + pickup_num[i][1]][pickup_num[i][2]] = pickup_rate;
					}
				}
				//ここからガチャ用のデータ生成
				var card_hit = [
					[],
					[],
					[]
				];//実際に当たる濃さのカード名群，2倍当たるカードが存在するのを再現
				var card_cnt = [
					[],
					[],
					[]
				];//当たったカード数をカウントする．
				var card_idx = [
					[],
					[],
					[]
				];//ダブりを管理する添え字配列．0,-1等が入る．-1なら一個前と同名カード
				//ガチャ用データ生成ループ
				for(i = 0;i < 3;i++){//UR,SR,Rを順次追加
					for(j = 0;j <= korabo + user_rank;j++){//解放ランクまでしか追加しない
						if(j == korabo){//常設出ないコラボやってるかチェックをここで実施
							let flag = 0;
							for(k = 0;k < korabo;k++){
								flag += bairitu[2][k] * only_korabo[k];
							}
							if(flag > 0)break;//常設追加せず終了
						}
						let len = card_name[i][j].length;
						for(k = 0;k < len;k++){
								if(j < korabo){//コラボガチャなら追加
									for(l = 0;l < bairitu[2][j];l++){
										card_hit[i].push(card_name[i][j][k]);
										card_cnt[i].push(0);
										card_idx[i].push(l * (-1));
									}	
								}else{//常設カード追加
									for(l = 0;l < bairitu[1][card_type[i][j][k]] * card_pick[i][j][k];l++){
										if(card_pick[i][j][k] > 1){
											card_hit[i].push(card_name[i][j][k] + " 《ピックアップ対象ｷﾀ――(ﾟ∀ﾟ)――!!》");
										}else{
											card_hit[i].push(card_name[i][j][k]);
										}
										card_cnt[i].push(0);
										card_idx[i].push(l * (-1));
									}
								}
						}
					}
				}
				//ここからガチャ処理
				var rVal;
				for(i = 0;i < nanren;i++){
					rVal = Math.random();
					let n1,n2;
					if(rVal <= rarity_rate[0]){
						n1 = 0;//UR
					}else if(rVal <= rarity_rate[0] + rarity_rate[1]){
						n1 = 1;//SR
					}else{
						n1 = 2;//R
					}
					n2 = getRandomInt(0,card_hit[n1].length);
					card_cnt[n1][n2]++;//当たったカードをインクリメント
				}

				document.write("UR " + rarity_rate[0] * 100 + "%, SR " + rarity_rate[1] * 100 + "%<br>\n");
				if(bairitu[1][0] * bairitu[1][1] * bairitu[1][2] != 1){
					document.write("常設火, 水, 木属性倍率 = " + bairitu[1][0] + ", " + bairitu[1][1] + ", " + bairitu[1][2] + "倍<br>\n");
				}
				document.write("解放カード" + rank[user_rank] + "ランクまで<br>\n");
				for(i = 0;i < korabo_name.length;i++){
					if(bairitu[2][i] > 0){
						if(only_korabo[i] == 0){
							document.write(korabo_name[i] + "コラボカード出現率" + bairitu[2][i] + "倍<br>\n");
						}else{
							document.write(korabo_name[i] + "コラボカード限定<br>\n");
						}
					}
				}
				if(is_pickup == 1){
					document.write(pickup_name + "【出現率" + pickup_rate +  "倍】<br\n>");
				}
				document.write("UR獲得期待値：" + nanren * rarity_rate[0] + "枚<br>\n");
				document.write("【" + nanren + "連カードガチャの結果！】↓↓<br>\n");

				for(i = 0;i < 3;i++){//3段階のレアリティごとに実行
					let len = card_hit[i].length;
					for(j = 1;j < len;j++){//ダブったカードの枚数を加算
						if(card_cnt[i][j] > 0 && card_idx[i][j] < 0){
							card_cnt[i][j + card_idx[i][j]] += card_cnt[i][j];
							card_cnt[i][j] = 0;
						}
					}
					for(j = 0;j < len;j++){//当たったカードレアリティ・カード名・枚数を表示
						if(card_cnt[i][j] > 0){
							document.write(rarity[i] + " " + card_hit[i][j] + " x " + card_cnt[i][j] + "<br>\n");
						}
					}
				}
		</script>
	</body>
</html>
